<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html;">
<title>Integrating Oscar with Eclipse</title>
</head>
<body text="#000000" bgcolor="#ffffff">
<font face="sans-serif">

<h1>Installation of Oscar<br>
</h1>

<b>by</b> <a href="mailto:michel.dhooge@trialog.com">Michel D'Hooge</a>

<p>
If you are behind a firewall, download the four jar files (oscar, api,
bundle, doc) from
<a href="http://forge.objectweb.org/project/showfiles.php?group_id=113">http://forge.objectweb.org/project/showfiles.php?group_id=113</a><br>
and the bundle repository description at
<a href="http://oscar-osgi.sf.net/repo/repository.xml">http://oscar-osgi.sf.net/repo/repository.xml</a><br>
<br>
Install with <tt>java -jar &lt;oscarpackage&gt;</tt> (and replace the
URLs by <tt>file:oscar...</tt> for local access).<br>
Unjar the installed files src.jar and bundlesrc.jar (there is a warning about
the manifest file present in both jar - normal)<br>
<br>
To check that everything is correct, you can run ANT on the build file.<br>

<h1>Eclipse</h1>

Do as usual for the installation :-)<br>

<h2>Creation of an Oscar Project</h2>
Create a java project with the contents pointing to oscar directory,
choose src and classes for source and output folders. Remove all the
libraries automatically selected but the ones defined in the build
file: org.mortbay.jetty-jdk1.2.jar, siena.jar, tablelayout.jar,
javax.servlet.jar, org.apache.jasper.jar, dtw.TelnetD.jar and
apache-xmlrpc.jar. I am not sure if it is important, but I advise to
order
the libraries in the same order as the ant build file.<br>
<br>
2nd check: Build the project with the eclipse project build command.
"Of course", this won't create the
jar files, but it is still convenient; and the compiled classes are
"shared" with the ant build file (so no time lost). Finally you can run
the Ant
plug-in on the build file to generate the bundles.<br>
<br>
Note: Since a bunch of warnings are reported in the Tasks view by eclipse, 
I changed the filter to "selected resource and its children".<br>

<h2>Launching Oscar</h2>

First we will create a new perspective with a big console view, then a
run action.<br>
In
window menu, save perspective as... Console. Then remove everything but
the console and hide the editors. Then, maybe save again...<br>
<br>
Create a Run Java Application with org.ungoverned.oscar.Main as the
main class. In the user classes classpath, remove everything and add
instead oscar.jar, moduleloader.jar and osgi.jar. In the source look-up
path, put the project itself. In the common tab, choose Console as the
perspective for Run mode.<br>
Note that with the default options of Eclipse (i.e. using the classes
folder) the framework blocks after entering profile name. I did not
investigate/debug it because in any cases you will need all the other
bundles to be available... but if you modify Oscar, remember to run the
ant build file.<br>
<br>
3rd check: You can now launch Oscar within eclipse.<br>
Put a breakpoint in the Main class and start the debug mode, you can go
step by step. In the same way, it is possible to debug an installed
bundle (you only need to provide the path to the source).<br>

<h2>OBR</h2>

The obr command is using the bundle repository in sourceforge. However,
if you are behind a firewall or if you want to test your bundles, or
simply because now you have all the bundles recompiled locally, you
need to modify OBR.<br>
<br>
First copy the file <tt>repository.xml</tt> in the root of oscar
(don't put it into the bundle folder otherwise it will be clean-ed by
the ant build file). Then replace all the lines 
<tt>http://oscar-osgi.sf.net/repo/XXX/XXX.jar</tt>
by <tt>file:bundle/XXX.jar</tt>.
<br>See org.ungoverned.oscar.service.bundlerepository.BundleRecord for
details of the format.<br>
<br>
Second, point OBR to your local copy by issuing a command like 
<tt>obr urls file:repository.xml</tt>. It is also possible to define
the property <tt>oscar.repository.url</tt> with the same URL.<br>
<br>
Third-party bundles are available on the sourceforge repository, but
will not be generated by the ant script (because the source are not 
provided with oscar!). My advice is to download them when needed (for 
instance the Log Reader may be of interest) and put them in the folder
<tt>bundle-3P</tt>. You must then modify the <tt>bundlerepository.txt</tt> 
file to point to the correct place.<br>
<br>
Last, when you develop your own bundles, if you want them to be available 
through OBR, create another bundle meta-data file and point to both files
with the <tt>obr urls</tt> command.<br>

</font>
</body>
</html>
