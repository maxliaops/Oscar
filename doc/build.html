<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Author" content="Richard S. Hall">
  <title>Building Oscar</title>
</head>
 <body text="#000000" bgcolor="#ffffff" link="#0000ee" vlink="#551a8b" alink="#ff0000">
<font face="sans-serif">

<h2>Building Oscar</h2>

<tt>Release version: 1.0.5 - May 13, 2005</tt>

<ul>
  <li> <a href="#requirements">Requirements</a></li>
  <li> <a href="#preparing">Preparing to Build</a></li>
  <li> <a href="#building">Building Oscar</a></li>
  <li> <a href="#bundles">Building Bundles</a></li>
  <li> <a href="#feedback">Feedback</a></li>
</ul>

<a name="requirements"></a>
<h2>Requirements</h2>

<p>
Everything needed to build Oscar is included in the release package
except the Java Development Kit (JDK) and Ant; the Oscar source code
and the Ant build file are included in the <tt>src.jar</tt> file of
the release package. It should be possible to build Oscar with versions
1.2.x, 1.3.x, and 1.4.x of the JDK; Oscar was developed under JDK 1.4.
The JDK is freely available from
<a href="http://java.sun.com/j2se/">Sun Microsystems</a>.
</p>

<p>
Ant is used as the build tool for Oscar; Ant is similar to the traditional
<tt>MAKE</tt> build tool, but is implemented completely in and designed
specifically for Java. Ant is freely available as part of the
<a href="http://jakarta.apache.org/ant">Jakarta Ant project</a>. Oscar was
built using version 1.6.1 of Ant and requires the <tt>subant</tt> task
introduced in Ant 1.6. To use Ant, install the latest version and add the
Ant <tt>bin</tt> directory to your <tt>PATH</tt> variable and set your
<tt>JAVA_HOME</tt> and <tt>ANT_HOME</tt> environment variables to point
to the JDK and Ant install directories, respectively.
</p>

<a name="preparing"></a>
<h2>Perparing to Build</h2>

<p>
The Oscar release package is bundled with the source code necessary to build
the framework itself and one example bundle. The source code is located in
the <tt>src.jar</tt> file in the Oscar installation directory. If you want
to build Oscar, you must unjar this file by typing the following command
inside the Oscar installation directory:
</p>

<pre>    jar xvf src.jar</pre>

<p>
Executing the above command will create the following files and directories
in your Oscar installation directory (assuming that you extracted it into
the installation directory as intended):
</p>

<ul>
  <li><tt>META-INF/</tt> - this directory can be deleted, since it only
      contains the automatically generated manifest header for the JAR file.
  </li>
  <li><tt>src/</tt> - this directory contains all of the source code for
      Oscar (i.e., the OSGi framework).
  </li>
  <li><tt>src-bundle/</tt> - this directory contains the source code for
      the <tt>simple.jar</tt> example bundle, but also is useful for
      building other bundles; more <a href="#bundles">details</a>
      below.
  </li>
  <li><tt>build.xml</tt> - this is the main build file for Oscar; it is
      used to build the framework and available bundles.
  </li>
</ul>

<a name="building"></a>
<h2>Building Oscar</h2>

<p>
Thanks to Ant, it is very easy to build Oscar using the <tt>build.xml</tt>
file. As stated in the <a href="#requirements">requirements</a> section,
you must have Ant installed and the necessary environment variables set for
Ant to function properly. Assuming that this is the case, building Oscar
and the example bundle is as simple as typing "<tt>ant</tt>". By default,
the Ant build file performs the following tasks:
</p>

<ol>
  <li>Create a directory, called <tt>classes/</tt>, in the Oscar installation
      directory for containing all compiled class files.
  </li>
  <li>Compile all Java source files in the <tt>src/</tt> with the class
      files being written to the above <tt>classes/</tt> directory.
  </li>
  <li>Create a <tt>moduleloader.jar</tt> file that contains the appropriate
      Module Loader packages from the <tt>classes/</tt> directory; the
      resulting JAR file is placed into the <tt>lib/</tt> directory.
  </li>
  <li>Create an <tt>osgi.jar</tt> file that contains the appropriate
      OSGi packages from the <tt>classes/</tt> directory; the
      resulting JAR file is placed into the <tt>lib/</tt> directory.
  </li>
  <li>Create an <tt>oscar.jar</tt> file that contains the appropriate
      Oscar packages from the <tt>classes/</tt> directory; the
      resulting JAR file is placed into the <tt>lib/</tt> directory.
  </li>
  <li>Build the example bundle by invoking its <tt>build.xml</tt>.
  </li>
</ol>

<p>
The resulting JAR files, <tt>moduleloader.jar</tt>, <tt>osgi.jar</tt>, and
<tt>oscar.jar</tt> are all placed in the <tt>lib/</tt> directory inside the
Oscar installation directory. This means building Oscar <b>will overwrite</b>
the originally installed <tt>JAR</tt> files, so you may want to experiment
on a second Oscar installation. In addition to the framework JAR files, the
resulting example bundle JAR file, <tt>simple.jar</tt>, is placed in the
<tt>bundle/</tt> directory inside the Oscar installation directory.
</p>

<p>
If you want to ensure that you are rebuilding a completely fresh version
of Oscar and the example bundle, you can type "<tt>ant clean</tt>" first.
This will delete any artifacts from previous builds so that you know that
you are starting from scratch. Cleaning <b>will also delete</b> the
<tt>moduleloader.jar</tt>, <tt>osgi.jar</tt>, and <tt>oscar.jar</tt> files
from the <tt>lib/</tt> directory, as well as the <tt>simple.jar</tt> file
from the <tt>bundle/</tt> directory.
</p>

<p>
If you only want to build the Oscar framework and do not want to build the
included example bundle or any of other bundles, then you can delete the
<tt>src-bundle/</tt> directory and only the framework will be built. On the
other hand, for those interested in building other bundles or only building
bundles, the next section describes how to do so.
</p>

<a name="bundles"></a>
<h2>Building Bundles</h2>

<p>
The Oscar project directory is structured such that the framework
source files are completely separate from any bundle
source files. All framework source code is in the <tt>src/</tt> directory
of the Oscar installation directory and all bundle source code is in
the <tt>src-bundle/</tt> directory. The goal is to make it simple to
build bundles as part of the overall build process when building Oscar
or to build them independently. To achieve integration in the overall
Oscar build process, the main Ant <tt>build.xml</tt> file assumes that
<tt>src-bundle/</tt> contains one directory per bundle, where each
bundle directory contains its own <tt>build.xml</tt> file. This allows
the build process to automatically integrate any bundle projects that
are placed into the <tt>src-bundle/</tt> directory using the <tt>subant</tt>
task that was introduced in Ant 1.6.
</p>

<p>
To achieve bundle independence, each bundle project contained in
<tt>src-bundle/</tt> should be completely self-contained, meaning that
it should be possible to build it directly by typing "<tt>ant</tt>" in
its directory, but so that it can be integrated with the main build
process, each should use particular properties that can be passed in
from the main build file to specify where created JAR files should be
placed. The details of the bundle <tt>build.xml</tt> file is not discussed
here, but can be found in the
<a href="http://oscar-osgi.sf.net/repo/bundlerepository/">bundle repository
documentation</a>. Additionally, the bundle repository documentation also
explains how to use OBR to download source code for bundles so that
they can be placed into the <tt>src-bundle/</tt> directory. Initially,
only the <tt>simple/</tt> directory for the example bundle is present
in <tt>src-bundle/</tt>.
</p>

<p>
If you <b>only</b> want to build bundles and not the framework, then you
can delete the <tt>src/</tt> directory that was extracted from the
<tt>src.jar</tt> file above. If the <tt>src/</tt> directory is not
present, then only the bundles will be built.
</p>

<a name="feedback"></a>
<h2>Feedback</h2>

<p>
For information on using Oscar, refer to <a href="usage.html">usage.html</a>.
If you have comments or suggestions, feel free to contact me at
<a href="mailto:heavy@ungoverned.org">heavy@ungoverned.org</a>.
</p>

<p>Richard S. Hall </p>

</font>
</body>
</html>
