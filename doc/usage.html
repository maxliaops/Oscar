<!DOCTYPE doctype PUBLIC "-//w3c//dtd html 4.0 transitional//en"><html><head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="Author" content="Richard S. Hall"><title>Oscar Usage</title></head>
<body text="#000000" bgcolor="#ffffff" link="#0000ee" vlink="#551a8b" alink="#ff0000">
<font face="sans-serif">

<h2>Oscar Usage</h2>

<tt>Release version: 1.0.5 - May 13, 2005</tt>

<ul>
   <li> <a href="#starting">Starting Oscar</a></li>
   <li> <a href="#shell">Oscar Shell</a></li>
   <ul>
      <li> <a href="#proxy">Installing Bundles and Proxies</a></li>
   </ul>
   <li> <a href="#configuring-oscar">Configuring Oscar</a></li>
   <ul>
	   <li> <a href="#change-ui">Changing the Command Shell User Interface</a></li>
   </ul>
   <li> <a href="#configuring-bundles">Configuring Bundles</a></li>
   <li> <a href="#eclipse">Using Oscar with Eclipse</a></li>
   <li> <a href="#feedback">Feedback</a></li>
</ul>

<a name="starting"></a>
<h2>Starting Oscar</h2>

<p>
To start Oscar, execute the appropriate shell script for your computer:
<tt>oscar.bat</tt> for Windows or <tt>oscar.sh</tt> for UNIX-based
operating systems. For UNIX-based systems you will need to do
"<tt>chmod +x oscar.sh</tt>" to make the script executable. A better
alternative is to execute Oscar from the installation directory
by typing:
</p>

<pre>
<font color="000099">
    java -jar lib/oscar.jar
</font>
</pre>

<p>
After executing the above command, you will be prompted to enter a profile
name; a profile is a simple way to organize sets of installed bundles and
any arbitrary name will suffice. By default, Oscar creates a directory,
called <tt>.oscar</tt>, in your home directory and inside of this
directory Oscar creates a separate sub-directory for each profile; this
behavior is configurable, see the
<a href="cache.html">bundle caching document</a> for more details. After
you have specified a profile name, either the text-based user interface
or the GUI-based user interface is started, depending on your
choice when installing Oscar. If you are not satisfied with your
installation-time choice of shell user interface, it is possible to
<a href="#change-ui">change your default shell user interface</a>.
</p>

<a name="shell"></a>
<h2>Oscar Shell</h2>

<p>
The main way to interact with Oscar is via its shell service. Oscar's
shell service is implemented as an OSGi service that
can have any number of user interfaces; see the
<a href="http://oscar-osgi.sf.net/repo/shell/">shell service</a>
documentation for more details. When you installed Oscar, you were
asked to select between a text-based or GUI-based shell; the shell
functionality is the same in both user interfaces. After starting Oscar,
type <tt>help</tt> into the shell to see the list of the available
commands; these are the default commands:
</p>

<pre>
<font color="000099">
	bundlelevel &lt;level&gt; &lt;id&gt; ... | &lt;id&gt; - set or get bundle start level.
	cd [&lt;base-URL&gt;]                     - change or display base URL.
	headers [&lt;id&gt; ...]                  - display bundle header properties.
	help                                - display shell commands.
	install &lt;URL&gt; [&lt;URL&gt; ...]           - install bundle(s).
	obr help                            - Oscar bundle repository.
	packages [&lt;id&gt; ...]                 - list exported packages.
	ps [-l]                             - list installed bundles.
	refresh                             - refresh packages.
	services [-u] [-a] [&lt;id&gt; ...]       - list registered or used services.
	shutdown                            - shutdown Oscar.
	start &lt;id&gt; [&lt;id&lt; &lt;URL&gt; ...]         - start bundle(s).
	startlevel [&lt;level&gt;]                - get or set framework start level.
	stop &lt;id&gt; [&lt;id&gt; ...]                - stop bundle(s).
	uninstall &lt;id&gt; [&lt;id&gt; ...]           - uninstall bundle(s).
	update &lt;id&gt; [&lt;URL&gt;]                 - update bundle.
	version                             - display version of Oscar.
</font>
</pre>

<p>
For a detailed description of how to install bundles into Oscar
refer to the <a href="#installing-bundles">next sub-section</a>; the
remainder of this section briefly describes shell behavior.
</p>

<p>
Despite the fact that the Oscar shell tries to mimic a typical Unix-like
shell, it is actually quite limited. The notion of <tt>cd</tt>, for example,
is only used to specify a default base URL in order to save typing. To
illustrate, assume that you want to load several bundles from a directory
on your disk, you could type:
</p>

<pre>
<font color="000099">
    cd file:/c:/projects/oscar/bundle/
</font>
</pre>

<p>
After issuing this <tt>cd</tt> command, you no longer need to type the complete
URL for bundles located in the above directory, only the name of the bundle
JAR file is necessary. Actually, only the root name of the JAR file is necessary
since the shell will automatically add <tt>.jar</tt> if it is not supplied.
It is not possible to perform an equivalent <tt>ls</tt> command to list the
contents of the current base URL, since this operation is not possible with
URLs. To view all currently installed bundles, use the <tt>ps</tt> command.
</p>

<p>
To exit the Oscar shell, simply type <tt>shutdown</tt>; any bundles that
are loaded will automatically be reloaded the next time you start the
associated profile. Additionally, any bundles that are active, will
be reactivated the next time you start the associated profile.
</p>

<a name="installing-bundles"></a>
<h3>Installing Bundles</h3>

<p>
A bundle is the OSGi term for a component for the OSGi framework. A bundle
is simply a JAR file containing a manifest and some combination of Java classes,
embedded JAR files, native code, and resources. A bundle may provide some
specific functionality for the user or it may implement a service that other
bundles can use; bundles can only use functionality from other bundles through
service interfaces and package sharing.
</p>

<p>
Oscar is packaged with seven bundles, which are located in the
<tt>bundle/</tt> directory of the Oscar installation directory. Six
of these bundles are used for implementing the Oscar shell and its
text and GUI user interface. The seventh bundle, <tt>simple.jar</tt>,
is an example bundle that illustrates many aspects of bundle
development. In additional to these bundles, many other bundles are
available from Oscar's bundle repository for easy installation. Access
to the bundle repository is provided by one of the included bundles
in the form of an Oscar shell command, named <tt>obr</tt>; see the
<a href="http://oscar-osgi.sf.net/repo/bundlerepository/">bundle repository
documentation</a> for more details.
</p>

<p>
Before installing any bundles, it is important to understand how bundles
are deployed into the framework. Bundles are deployed in two stages; first
they are installed, then they are started. To install a bundle use the
<tt>install</tt> shell command followed by a bundle URL. For example, to
install the <tt>simple.jar</tt> bundle you type (assuming you have started
Oscar from its installation directory):
</p>

<pre>
<font color="000099">
    install file:bundle/simple.jar
</font>
</pre>

<p>
Once a bundle is installed, it can then be started by using the
<tt>start</tt> command and the bundle identifier of the desired bundle.
The <tt>ps</tt> shell command is used to list all installed bundles
and to obtain the bundle's identifier. The following Oscar shell session
capture illustrates how to start the <tt>simple.jar</tt> bundle:
</p>

<pre>
<font color="000099">
	-&gt; install file:bundle/simple
	-&gt; ps
	START LEVEL 1
	   ID   State         Level  Name
	[   0] [Active     ] [    0] System Bundle (1.0.0)
	[   1] [Active     ] [    1] Shell Service (1.0.0)
	[   2] [Active     ] [    1] Shell TUI (1.0.0)
	[   3] [Active     ] [    1] Bundle Repository (1.0.0)
	[   4] [Installed  ] [    1] Simple (1.0.0)
	-&gt; start 4
	Simple Bundle 4 has started.
	From native: Hello!
	From embedded JAR: Hello!
	Resource = null
	The 'javax.servlet.http' package is not available.
	The 'javax.servlet' package is not available.
	-&gt;
</font>
</pre>

<p>
The <tt>stop</tt> command is used to stop a bundle and the
<tt>uninstall</tt> command is used to remove a bundle from Oscar.
As an alternative to using the <tt>install</tt> and <tt>start</tt> commands
explicitly, it is also possible to install and start a bundle in one
step by using the <tt>start</tt> command with a bundle URL.
</p>

<p>
Bundles can be updated using the <tt>update</tt> command. The update
command allows you to specify a URL from which to retrieve the updated
bundle, but if one is not specified it will try to update the bundle
from the bundle's <tt>Bundle-UpdateLocation</tt> manifest attribute,
if present, or the bundle's original location URL.
</p>

<p>
<b>Important:</b> When you <tt>update</tt> or <tt>uninstall</tt> a bundle, the
changes appear to take effect immediately, but in reality the changes are
only partially enacted. If a bundle is updated or uninstalled and it was
exporting packages, these packages are not removed until the framework
is refreshed using the <tt>PackageAdmin</tt> service. The Oscar shell
offers a convenient <tt>refresh</tt> command for this purpose.
</p>

<p>
For an introduction to writing bundles and services, refer to the
<a href="http://oscar-osgi.sf.net/tutorial/">Oscar bundle tutorial</a> or the tutorials
provided by Sun for
<a href="http://java.sun.com/j2me/docs/pdf/tutorialwin.pdf">Windows</a> and
<a href="http://java.sun.com/j2me/docs/pdf/tutorialsol.pdf">Solaris</a>.
</p>

<a name="proxy"></a>
<h3>Installing Bundles and Proxies</h3>

<p>
If you use a proxy for Web access, then you may run into difficulty
using the Oscar shell to install bundles from a remote URL. To remedy
this situation, certain system properties must be set to make Oscar work
with your proxy. These properties are:
</p>

<ul>
  <li><tt>http.proxyHost</tt> - the name of the proxy host.
  </li>
  <li><tt>http.proxyPort</tt> - the port of the proxy host.
  </li>
  <li><tt>http.proxyAuth</tt> - the user name and password to use when
      connecting to the proxy; this string should be the user name and
      password separated by a colon (e.g., <tt>rickhall:mypassword</tt>).
  </li>
</ul>

<p>
These system properties can be set directly on the command line when
starting the JVM using the standard "<tt>-D&lt;prop&gt;=&lt;value&gt;</tt>"
syntax or you can put them in the <tt>lib/system.properties</tt> file of
your Oscar installation; see documentation on
<a href="#configuring-oscar">configuring Oscar</a> for more information.
</p>

<a name="configuring-oscar"></a>
<h2>Configuring Oscar</h2>

<p>
Oscar uses properties to configure certain aspects of its behavior.
When you run Oscar from the command line, it tries to find all of its
configuration properties using <tt>System.getProperty()</tt>. To configure
Oscar via system properties, you can specify system properties when you type
the <tt>java</tt> command to execute Oscar using the standard
"<tt>-D&LT;prop&GT;=&LT;value&GT;</tt>" syntax. You can also specify
system properties in Oscar's <tt>system.properties</tt> file, which is located
in the same directory as <tt>oscar.jar</tt> (i.e., <tt>lib/</tt> by
default). Any property placed in the <tt>system.properties</tt> file will
be made accessible at run time via <tt>System.getProperty()</tt>. The
properties file uses standard Java property file syntax
(i.e., attribute-value pairs).
</p>

<p>
As stated above, the <tt>system.properties</tt> file is located in the
same directory as the <tt>oscar.jar</tt> file. It is possible to
change this location by specifying a new location value using the
<tt>oscar.system.properties</tt> property, which defines the full path
and name of the desired property file. Note: It is not possible to set
this property value inside of the <tt>system.properties</tt> file, since
Oscar needs this value to start execution; this command must be specified
on the command line when starting Oscar. All remaining configuration
properties can be set either at the command line or in the
<tt>system.properties</tt> file. <i>Note: Command-line properties are
overwritten by properties in the <tt>system.properties</tt> file.</i>
</p>

<p>
There is another way to specify Oscar's configuration properties, but to
do so you must manually instantiate an instance of Oscar, rather than
executing Oscar's JAR file. When you instantiate an instance of Oscar you
are able to pass in configuration properties via Oscar's constructor.
If an Oscar instance receives properties in its constructor, then it will
only use these properties and all system properties (i.e.,
<tt>System.getProperty()</tt>) are ignored. This is helpful in situations
where you want to create multiple or nested instances of Oscar.
</p>

<p>
The following properties are all of Oscar's configuration
properties:
</p>

<ul>
    <li><tt>oscar.system.properties</tt> - The location of the
        <tt>system.properties</tt> file; by default this file is
        located in the <tt>lib</tt> directory of the Oscar installation
        directory. This file contains attribute-value property pairs and
        Oscar will automatically load these properties and make them
        available via <tt>System.getProperty()</tt>. This property
        can only be specified on the command line when starting Oscar;
        it is not possible to specify this property in the
        <tt>system.properties</tt> file since that would be too late.
    </li>
    <li><tt>oscar.bundle.properties</tt> - The location of the
        <tt>bundle.properties</tt> file; by default this file is
        located in the <tt>lib</tt> directory of the Oscar installation
        directory. This file contains attribute-value property pairs and
        Oscar will automatically load these properties and make them
        available via to all installted bundles via
        <tt>BundleContext.getProperty()</tt>.
    </li>
    <li><tt>oscar.cache.class</tt> - The class name to be used when
        creating an instance for the bundle cache; this class must
        implement the <tt>BundleCache</tt> interface and have a default
        constructor. By default, Oscar will create an instance of
        <tt>DefaultBundleCache</tt> for the bundle cache.
    </li>
    <li><tt>oscar.auto.install</tt> - Space-delimited list of bundles
        to automatically install when Oscar is started. By default,
        the bundles specified in this property will be installed into
        start level 1. It is also possible to append a specific
        start level to this property name to assign to the specified
        bundles (e.g., <tt>oscar.auto.install.2</tt>). These variants
        will be processed in sequence until a successor cannot be
        found (e.g., <tt>oscar.auto.install.0</tt>, <tt>oscar.auto.install.1</tt>,
        etc.).
    </li>
    <li><tt>oscar.auto.start</tt> - Space-delimited list of bundles
        to automatically install and start when Oscar is started.
        By default, the bundles specified in this property will be
        installed into start level 1. It is also possible to append a
        specific start level to this property name to assign to the
        specified bundles (e.g., <tt>oscar.auto.start.2</tt>). These
        variants will be processed in sequence until a successor cannot be
        found (e.g., <tt>oscar.auto.start.0</tt>, <tt>oscar.auto.start.1</tt>,
        etc.).
    </li>
    <li><tt>oscar.startlevel.framework</tt> - The initial start level
        of the Oscar framework once it starts execution; the default
        value is 1.
    </li>
    <li><tt>oscar.startlevel.bundle</tt> - The default start level for
        newly installed bundles; the default value is 1.
    </li>
    <li><tt>oscar.embedded.execution</tt> - Flag to indicate whether
        Oscar is embedded into a host application; the default value is
        "<tt>false</tt>". If this flag is "<tt>true</tt>" then Oscar
        will not called <tt>System.exit()</tt> upon termination.
    </li>
    <li><tt>oscar.strict.osgi</tt> - Flag to indicate whether Oscar is
        running in strict OSGi mode; the default value is "<tt>true</tt>".
        If this flag is "<tt>false</tt>" it enables two non-OSGi-compliant
        features: persisting <tt>BundleActivator</tt>s that implement
        <tt>Serializable</tt> and matching of sub-packages when resolving
        imported packages to eliminate exhaustive listing of package
        exports (e.g., the import <tt>javax.servlet.http</tt> will
        match the export <tt>javax.servlet</tt>). These features are
        not recommended since they are non-compliant. (Currently, this
        last non-strict feature is broken and may never be fixed.)
    </li>
</ul>

<p>
The above properties are standard for the Oscar framework, but
properties also exist to configure Oscar's default bundle cache.
The bundle cache properties are dependent on the cache implementation
you are using, which can be specified via the
<tt>oscar.cache.class</tt> property described above. If you are
using the default bundle cache, then you may specify the
following properties on the command line, in the
<tt>system.properties</tt> file, or to Oscar's constructor:
</p>

<ul>
    <li><tt>oscar.cache.bufsize</tt> - Sets the buffer size to be used by
        the cache; the default value is 4096. The integer
        value of this string provides control over the size of the
        internal buffer of the disk cache for performance reasons.
    </li>
    <li><tt>oscar.cache.dir</tt> - Sets the directory to be used by the
        cache as its cache directory. The cache directory is where all
        profile directories are stored and a profile directory is where a
        set of installed bundles are stored. By default, the cache
        directory is <tt>.oscar</tt> in the user's home directory. If
        this property is specified, then its value will be used as the cache
        directory instead of <tt>.oscar</tt>. This directory will be created
        if it does not exist.
    </li>
    <li><tt>oscar.cache.profile</tt> - Sets the profile name that will be
        used to create a profile directory inside of the cache directory.
        The created directory will contained all installed bundles associated
        with the profile.
    </li>
    <li><tt>oscar.cache.profiledir</tt> - Sets the directory to use as the
        profile directory for the bundle cache; by default the profile
        name is used to create a directory in the <tt>.oscar</tt> cache
        directory (more precisely <tt>${oscar.cache.dir}/${oscar.cache.profile}</tt>).
        If the <tt>oscar.cache.profiledir</tt> property is specified, then
        the cache directory and profile name properties are ignored since
        they are only used to calculate the profile directory. The
        specified value of profile directory property is used directly as
        the directory to contain all cached bundles. This directory will be
        created if it does not exist.
    </li>
</ul>

<p>
The Oscar installation contains a default <tt>system.properties</tt> file
in the <tt>lib/</tt> directory for automatically starting the shell service
and shell user interface. The next section describes configuration
properties can be used to configure installed bundles.
</p>

<a name="change-ui"></a>
<h3>Changing the Command Shell User Interface</h3>
<p>
Oscar's <a href="http://oscar-osgi.sf.net/repo/shell/">shell service</a>
supports multiple user interface implementations; the default shell user
interface is text-based, but a simple graphical shell is also provided.
To change the default shell user interface, you must modify the
<tt>oscar.auto.start</tt> property in the <tt>system.properties</tt> file
in the <tt>lib/</tt> directory of your Oscar installation. For the
text-based user interface, the property value should look like this:
</p>

<pre>
<font color="000099">
    oscar.auto.start.1=file:bundle/shell.jar file:bundle/shelltui.jar \
        file:bundle/bundlerepository.jar
</font>
</pre>

<p>
This property value instructs Oscar to automatically start the shell
service, the shell textual user interface, and the
bundle repository. (<i>Note: The "<tt>\</tt>" character at the
end of the above line indicated that the property value continues on the
next line; it is also possible to specify the property value on one
line.</i>) For the GUI-based shell user interface, the property value
should look like this:
</p>

<pre>
<font color="000099">
    oscar.auto.start=file:bundle/shell.jar file:bundle/bundlerepository.jar \
        file:bundle/tablelayout.jar file:bundle/shellgui.jar \
        file:bundle/shellplugin.jar
</font>
</pre>

<p>
This property value instructs Oscar to automatically start the shell
service, the bundle repository, the table layout library (needed by the
shell GUI bundle), the shell GUI, and the GUI shell components.
</p>

<a name="configuring-bundles"></a>
<h2>Configuring Bundles</h2>

<p>
Some bundles use properties to configure certain aspects of their
behavior. As an example, the default URL for the <tt>cd</tt> command
of the shell service can be specified using the property
<tt>oscar.shell.baseurl</tt>. It is a good idea, when
implementing bundles, to parameterize them with properties where
appropriate. To learn about the configuration options for specific
bundles, refer to the documentation that accompanies them.
</p>

<p>
Bundle properties are set by using the <tt>bundle.properties</tt>
property file. Any property placed in this file will be accessible
via <tt>BundleContext.getProperty()</tt> at run time. The property
file uses the standard Java property file syntax (i.e.,
attribute-value pairs). By default, the <tt>bundle.properties</tt>
file is located in the same directory as the <tt>oscar.jar</tt> file.
It is possible to change this location by specifying a new location
value using the <tt>oscar.bundle.properties</tt> system property
(described in the <a href="#configuring-oscar">previous section</a>),
which should contain the full path and name of the desired property
file.
</p>

<p>
Bundles cannot directly access system properties via
<tt>BundleContext.getProperty()</tt>, but it is possible to push
system properties into the bundle property values. This is achieved through
system property substitution, which is instigated by marking text in
the bundle property value with <tt>${...}</tt>, where "<tt>...</tt>" is the
name of a system property. When such a property value is retrieved by a
bundle, the system property value will be substituted into the bundle
property value as appropriate.
</p>

<a name="eclipse"></a>
<h2>Using Oscar with Eclipse</h2>

<p>
For those people using the Eclipse IDE, there are
<a href="eclipse.html">instructions</a> available for using Eclipse and
Oscar together.
</p>

<a name="feedback"></a>
<h2>Feedback</h2>

<p>
If you have comments or suggestions, feel free
to contact me at <a href="mailto:heavy@ungoverned.org">heavy@ungoverned.org</a>.
</p>
<p>Richard S. Hall </p>

</font>
</body></html>
